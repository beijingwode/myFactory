<!DOCTYPE html>
<html lang="zh-cn">
	<head>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>我的网平台商家对账单</title>

		<meta name="description" content="login" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<link rel="stylesheet" href="${ctxPath!}/static/bootstrap/bootstrap.min.css" />
		<link rel="stylesheet" href="${ctxPath!}/static/css/font-awesome.min.css" />

		<link rel="stylesheet" href="${ctxPath!}/static/ace/css/ace.min.css" />

		<link rel="stylesheet" href="${ctxPath!}/static/ace/css/ace-rtl.min.css" />

		<script src="${ctxPath!}/static/jquery/jquery-2.1.1.min.js"></script>
	</head>

	<body class="">
<div class="layer">
<div class="profile-user-info profile-user-info-striped" id="order_home">
	<div class="profile-info-row">
		<div class="profile-info-name">订单ID</div>
		<div class="profile-info-value">
			${vo.subOrderId!}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">创建时间</div>
		<div class="profile-info-value">
			${vo.createTime!,dateFormat="yyyy-MM-dd HH:mm:ss"}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">运费</div>
		<div class="profile-info-value">
			￥${vo.totalShipping!}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">应收金额</div>
		<div class="profile-info-value">
			￥${vo.realPrice!}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">实收金额</div>
		<div class="profile-info-value">
			￥${vo.cashPay!}+${vo.thirdPay!} 
			&nbsp;&nbsp;&nbsp;&nbsp;
			@if(vo.cashPay>0){
			现金券 &nbsp;(${vo.cashNo!})
			@}
			&nbsp;&nbsp;&nbsp;&nbsp;
			@if(vo.thirdPay>0){
				@if(vo.thirdType=='zhifubao'){
				支付宝&nbsp;(${vo.thirdNo!})
				@}else if(vo.thirdType=='pingtaiyue'){
				现金券&nbsp;(${vo.thirdNo!})
				@}else if(vo.thirdType=='wxpay'){
				微信&nbsp;(${vo.thirdNo!})
				@}else if(vo.thirdType=='unionpay'){
				银联&nbsp;(${vo.thirdNo!})
				@}
			@}
		
			&nbsp;&nbsp;&nbsp;&nbsp;<span id="wxType" style="color: #336199;"></span>
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">订单状态</div>
		<div class="profile-info-value">
			@if(vo.status==0){
			未支付
			@}else if(vo.status==1){
			已支付
			@}else if(vo.status==2){
			已发货
			@}else if(vo.status==3){
			申请退货
			@}else if(vo.status==4){
			已收货
			@}else if(vo.status==5){
			申请退款
			@}else if(vo.status==11){
			已退货
			@}else if(vo.status==12){
			已退款
			@}else if(vo.status==-1){
			已取消
			@}else if(vo.status==13){
			商家同意退货
			@}else if(vo.status==14){
			商家拒绝退货
			@}else if(vo.status==15){
			商家同意退款
			@}else if(vo.status==16){
			商家拒绝退款
			@}else {
			@}
			
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			@if(vo.closeFlg=='2'){
			<a href="http://wdwmananger.wd-w.com/saleBill/getSaleBillDetail?id=${vo.saleBillId!}" target="_blank">
				已出账 查看
			</a>
			@}	
			
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">付款时间</div>
		<div class="profile-info-value">
			${vo.payTime!,dateFormat="yyyy-MM-dd HH:mm:ss"}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">发货时间</div>
		<div class="profile-info-value">
			${vo.sendTime!,dateFormat="yyyy-MM-dd HH:mm:ss"}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">确认收货时间</div>
		<div class="profile-info-value">
			${vo.takeTime!,dateFormat="yyyy-MM-dd HH:mm:ss"}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">商家（招商）</div>
		<div class="profile-info-value">
			${vo.supplierName!} (${vo.managerName!})
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">到款确认</div>
		<div class="profile-info-value">
			@if(vo.payConfirm==0){
			未到款
			@}else if(vo.payConfirm==1){
			已到款
			@}else {
			@}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">到款确认时间</div>
		<div class="profile-info-value">
			${vo.payConfirmDate!,dateFormat="yyyy-MM-dd HH:mm:ss"}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">取消时间</div>
		<div class="profile-info-value">
			${vo.cancelTime!,dateFormat="yyyy-MM-dd HH:mm:ss"}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">取消原因</div>
		<div class="profile-info-value">
			${vo.closeReason!}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">退款原因</div>
		<div class="profile-info-value">
			${returnSeason!}
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">拒绝退款原因</div>
		<div class="profile-info-value">
			${vo.refuseNote!}
		</div>
	</div>
</div>
	<ul class="nav nav-tabs" id="${vo.subOrderId!}">
		<li class="active">
			<a data-toggle="tab" href="#user" onclick="tabChange(this)"> 
				<i class="green ace-icon fa fa-users bigger-120"></i> 买家信息
			</a>
		</li>
		<li>
			<a data-toggle="tab" href="#order" onclick="tabChange(this)"> 
				<i class="green ace-icon fa fa-users bigger-120"></i> 收货信息
			</a>
		</li>
		<li>
			<a data-toggle="tab" href="#items" onclick="tabChange(this)"> 
				<i class="green ace-icon fa fa-users bigger-120"></i> 商品信息
			</a>
		</li>
		<li>
			<a data-toggle="tab" href="#favorites" onclick="tabChange(this)"> 
				<i class="green ace-icon fa fa-users bigger-120"></i> 调剂清单
			</a>
		</li>
	</ul>
	<div class="tab-content">
		<div class="profile-user-info profile-user-info-striped tab-pane active" id="user">
			<div class="profile-info-row">
				<div class="profile-info-name">买家id</div>
				<div class="profile-info-value">
					${order.userId!}
				</div>
			</div>
			<div class="profile-info-row">
				<div class="profile-info-name">公司名称</div>
				<div class="profile-info-value">
					${enterPriseName!}
				</div>
			</div>
			@for(item in roles){
				@if(item.id == 25) {
			<div class="profile-info-row">
				<div class="profile-info-name">现金券流水</div>
				<div class="profile-info-value" id="flowTable">
					<a href="javascript:void(0);" onclick="javascript:showCashFlow('${order.userId!}');">
						 查看
					</a>
				</div>
			</div>
				@}
			@}
		</div>
		<div class="profile-user-info profile-user-info-striped tab-pane" id="order">
			<div class="profile-info-row">
				<div class="profile-info-name">收件人</div>
				<div class="profile-info-value">
					${order.name!}
				</div>
			</div>
			<div class="profile-info-row">
				<div class="profile-info-name">电话</div>
				<div class="profile-info-value">
					${order.mobile!}
				</div>
			</div>
			<div class="profile-info-row">
				<div class="profile-info-name">收货地址</div>
				<div class="profile-info-value">
					${order.address!}
				</div>
			</div>
			<div class="profile-info-row">
				<div class="profile-info-name">发票抬头</div>
				<div class="profile-info-value">
					${order.invoiceTitle!}
				</div>
			</div>
			<div class="profile-info-row">
				<div class="profile-info-name">备注</div>
				<div class="profile-info-value">
					${note!}
				</div>
			</div>
		</div>
		
		<div class="profile-user-info profile-user-info-striped tab-pane" id="items">
			<table class="table table-striped table-bordered table-hover nomargin-bottom">
				<thead>
					<tr>
						<th class="center">商品名称</th>
						<th class="center">特省</th>
						<th class="center">规格</th>
						<th class="center">购买数量</th>
						<th class="center">单价</th>
						<th class="center">运费</th>
						<th class="center">佣金比例</th>
					</tr>
				</thead>
				@for(subItem in items){
				<tbody>
					<tr>
						<td class="center">
							<a href="${webUrl}${subItem.productId!}.html" target="_blank">
								<p>${subItem.productName!}</p>
								<img src="${subItem.image!}" style="width: 90px">
							</a>	
						</td>
						<td class="center">
							@if(subItem.saleKbn == 2){
								换领
							@} else if(subItem.saleKbn == 1){
								特省
							@} else if(subItem.saleKbn == 5){
								试用
							@}
						</td>
						<td class="center">
							${subItem.itemValues!}
						</td>
						<td class="center">
							${subItem.number!}
						</td>
						<td class="center">
							￥${subItem.internalPurchasePrice!}
						</td>
						<td class="center">
							${subItem.shipping!}
						</td>
						<td class="center">
							${subItem.commissionRatio!}%
						</td>
					</tr>
				@}
				</tbody>
			</table>
		</div>
		
		
		<div class="profile-user-info profile-user-info-striped tab-pane" id="favorites">
			<table class="table table-striped table-bordered table-hover nomargin-bottom">
				<thead>
					<tr>
						<th class="center">商品id</th>
						<th class="center">商品名称</th>
						<th class="center">商家id</th>
						<th class="center">店铺名称</th>
						<th class="center">单价</th>
						<th class="center">主图</th>
						<th class="center">库存</th>
					</tr>
				</thead>
				@for(p in favorites){
				<tbody>
					<tr>
						<td class="center">
							${p.productId!}
						</td>
						<td class="center">
							<a href="${webUrl}${p.productId!}.html" target="_blank">
								${p.productName!}
							</a>	
						</td>
						<td class="center">
							${p.supplierId!}
						</td>
						<td class="center">
							${p.shopName!}
						</td>
						<td class="center">
							￥${p.salePrice!}
						</td>
						<td class="center">
							<img src="${p.imagePath!}" style="width: 90px">
						</td>
						<td class="center">
							${p.stock!}
						</td>
					</tr>
				@}
				</tbody>
			</table>
		</div>
	</div>
	
	
<script type="text/javascript">
$(function(){
	if("${expressCom!}" != "" && "${expressNo!}"!="") {
		showExpress();
	}
	
	if("${vo.thirdType!}" == "wxpay" && "${vo.thirdNo!}"!="") {
		getWxAppId("${vo.thirdNo!}");
	}
});

function tabChange(obj) {
	$(".nav-tabs li").removeClass("active");
	$($(obj).parent()).addClass("active");

	$(".tab-content div").removeClass("active");
	$($(obj).attr("href")).addClass("active");
}

function showCashFlow(userId) {
	$.ajax({
		dataType:'json',
		type:'POST',
		url:'${ctxPath}/orderList/getCashFlow?userId='+userId,
		contentType: 'application/json',
		async: true,
		success:function(data){
			var html='';
			html += '<table class="table table-striped table-bordered table-hover nomargin-bottom">';
			html += '<tr><th>时间</th><th>操作</th><th>金额</th><th>余额</th><th>备注</th></tr>';
			for(var i=0;i<data.length;i++) {
				html += '<tr>';
				html += '<td>'+ formatDate(data[i].opDate) +'</td>';
				html += '<td>'+ getOpname(data[i].opCode) +'</td>';
				html += '<td class="center">'+ data[i].cash +'</td>';
				html += '<td class="center">'+ data[i].cashBalance +'</td>';
				html += '<td>'+ data[i].note +'</td>';
				html += '</tr>';
			}
			html += '</table>';
			
			$("#flowTable").html(html);
		}
	});
}

function getWxAppId(tradeNo) {
	$.ajax({
		dataType:'json',
		type:'POST',
		url:'${ctxPath}/orderList/payAppId?tradeNo='+tradeNo,
		contentType: 'application/json',
		async: true,
		success:function(ret){
			if(ret.data == "wx1b153767a3760be4") {
				$("#wxType").html("微信APP");
			} else if (ret.data == "wxb62e121cbeffdddf"){
				$("#wxType").html("微信公众号");				
			}
		}
	});
}

function   formatDate(num)   {
	var now =new Date(num)
    var   year=now.getFullYear();     
    var   month=now.getMonth()+1;     
    var   date=now.getDate();     
    var   hour=now.getHours();     
    var   minute=now.getMinutes();     
    var   second=now.getSeconds();     
    return   year+"-"+(month<10?"0":"")+ month+"-"+(date<10?"0":"")+date+"   "+hour+":"+minute+":"+second;     
}



function   getOpname(code)   {
	var name = "订单支付";
    if("216"==code) {
    	name="企业发放福利";
    } else if("217"==code) {
    	name="企业回收福利";
    } else if("203"==code) {
    	name="电商消费";
    } else if("202"==code) {
    	name="电商退款";
    } else if("205"==code) {
    	name="馈赠亲友";
    } else if("204"==code) {
    	name="收回馈赠";
    } else if("206"==code) {
    	name="获得馈赠";
    } else if("207"==code) {
    	name="返还馈赠";
    } else if("290"==code) {
    	name="平台派发";
    } else if("292"==code) {
    	name="app首次登陆奖励";
    } else if("294"==code) {
    	name="热卖销售奖励";
    } else if("296"==code) {
    	name="评论奖励";
    } else if("222"==code) {
    	name="红包退回";
    } else if("220"==code) {
    	name="收到红包";
    } else if("221"==code) {
    	name="发送红包";
    }
    return name;     
}     
    
function showExpress() {
    var content = '"sname":"express.ExpressSearch","com":"${expressCom!}","express_no":"${expressNo!}","version":"v2"';
    $.ajax({
        url: 'http://kuaidi.wo-de.com/express/busJsonp.do?content={' + content + '}&token=',
        dataType: 'jsonp',
        jsonp: 'jsonpcallback',
        success: function (json) {
        	try{
            var ary = eval(json.body.history);
            var lis = "";
            if (ary.length > 0) {
                lis = '<p class="cur">' + ary[0].dealDate + '<span>&nbsp;&nbsp;' + ary[0].des + '</span></p>';
                for (var i = 1; i < ary.length; i++) {
                    lis += '<p>' + ary[i].dealDate + '<span>&nbsp;&nbsp;' + ary[i].des + '</span></p>';
                }
            }
            $("#express").html(lis);
        	} catch(e) {}
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
        }
    });
}
</script>
</div>
	</body>
</html>