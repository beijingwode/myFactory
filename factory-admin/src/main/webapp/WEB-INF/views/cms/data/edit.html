<div class="layer" id="p_updateAppImg">
<div class="profile-user-info profile-user-info-striped wordbreak" >
	
	<input value="${data.id!}" type="hidden" id="p_id">
	<div class="profile-info-row">
		<div class="profile-info-name">渠道</div>
		<div class="profile-info-value">
			<select id="p_channel" onchange="getPagesOnData()" style="width:90%">
				@if(channel == 1){
					<option value="1" selected="selected">pc</option>
					<option value="2">微信/APP</option>
				@} else{
					<option value="1">pc</option>
					<option value="2" selected="selected">微信/APP</option>
				@}
			</select>
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">所属页面</div>
		<div class="profile-info-value">
			<select id="p_pageId" style="width:90%" onchange="getSectionsOnData()">
				@for(item in plist){
					@if(item.id== pageId){
						<option value="${item.id!}" selected="selected">${item.title!}</option>
					@}else{
						<option value="${item.id!}">${item.title!}</option>
					@}
				@}
	  		</select>	
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">所属位置</div>
		<div class="profile-info-value">
			<select id="p_sectionId" style="width:90%" onchange="setSection()">
				@if(sList!=null && !isEmpty(sList) && sectionId!=null){
				@for(item in sList){
					@if(item.id== sectionId){
						<option value='${item.id!}*_*${item.ex1Name!}*_*${item.ex2Name!}*_*${item.ex3Name!}*_*${item.ex4Name!}*_*${item.ex5Name!}*_*${item.ex6Name!}*_*${item.title1Name!}*_*${item.title2Name!}' selected="selected">${item.title!}</option>
					@}else{
						<option value='${item.id!}*_*${item.ex1Name!}*_*${item.ex2Name!}*_*${item.ex3Name!}*_*${item.ex4Name!}*_*${item.ex5Name!}*_*${item.ex6Name!}*_*${item.title1Name!}*_*${item.title2Name!}'>${item.title!}</option>
					@}
				@}
				@}
	  		</select>	
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">主标题(商品名)</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_title" value="${data.title!}" /></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name" id="p_title1name">${title1Name!}</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_title1" value="${title1Value!}" placeholder="${title1Placeholder!}"  /></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name" id="p_title2name">${title2Name!}</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_title2" value="${title2Value!}" placeholder="${title2Placeholder!}"   /></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">排序</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_orders" value="${data.orders!}"/></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">链接</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_link" value="${data.link!}"/></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">图片</div>
		<div class="profile-info-value">			
			<div id="ImageId">
			<img alt="" class="Img" src="${data.imagePath!}" name="type" height="50px" width="150px">
			</div>
			<input type="hidden" value="${data.imagePath!}" class="heddenImg" id="p_imagePath"/>
			<input type="button" value="删除图片" onclick="deleteImage()"/>
			<input type="hidden" id="imageStu">
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name">上传</div>
		<div class="profile-info-value">
			<input type="file" name="type" id="uploadFile" />
			<input type="button" value="上传" onclick="pageDataUpdateUploadImg()"/>
		</div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name" id="p_ex1Name">
			${ex1Name!}
		</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_ex1Value" value='${ex1Value!}' placeholder="${ex1Placeholder!}" /></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name" id="p_ex2Name">
			${ex2Name!}
		</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_ex2Value" value='${ex2Value!}' placeholder="${ex2Placeholder!}"/></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name" id="p_ex3Name">
			${ex3Name!}
		</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_ex3Value" value='${ex3Value!}' placeholder="${ex3Placeholder!}"/></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name" id="p_ex4Name">
			${ex4Name!}
		</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_ex4Value" value='${ex4Value!}' placeholder="${ex4Placeholder!}" /></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name" id="p_ex5Name">
			${ex5Name!}
		</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_ex5Value" value='${ex5Value!}' placeholder="${ex5Placeholder!}"/></div>
	</div>
	<div class="profile-info-row">
		<div class="profile-info-name" id="p_ex6Name">
			${ex6Name!}
		</div>
		<div class="profile-info-value"><input type="text"  style="width:90%" id="p_ex6Value" value='${ex6Value!}' placeholder="${ex6Placeholder!}"/></div>
	</div>
</div>

<div class="width-100 clearfix" tag-save-btn style="bottom: 0px;left: 0px;position:absolute;">
	<span class="btn btn-primary btn-sm bigger-110 width-100  pull-left" id="submit">
		<i class="ace-icon fa fa-floppy-o align-top bigger-125"></i>保存
	</span>
</div>
</div>

<script type="text/javascript" src="${ctxPath!}/static/js/ajaxfileupload.js"></script>
<script type="text/javascript" src="${ctxPath!}/static/js/manageUploadImg.js"></script>
<script>
	function getPagesOnData()
	{
		$.ajax( {  
		    url:'${ctxPath}/cmsPage/getPages?channel='+$("#p_channel").val(),
		    type:'post',
		    dataType:'json',
		    success:function(data) {
				var html = '';
		    	//再添加
		    	for(var i =0;i<data.length;i++){
		    		html += '<option value="'+ data[i].id +'">'+ data[i].title +'</option>';
		    	}
		    	
		    	$("#p_pageId").html(html);
		    	
		    	getSectionsOnData();
		    },  
		     error : function() {  
		     }  
		});
	}
	
	function getSectionsOnData()
	{
		var pid= $("#p_pageId").val();
		if(pid!=null && pid!="") {
			$.ajax( {  
			    url:'${ctxPath}/cmsPage/getSections?pid='+pid,
			    type:'post',
			    dataType:'json',
			    success:function(data) {
					var html='<option value="">全部</option>';
			    	//再添加
			    	for(var i =0;i<data.length;i++){
			    		var val = data[i].id;
			    		val += "*_*";
			    		if(data[i].ex1Name != null && data[i].ex1Name!="undefined") {
				    		val += data[i].ex1Name;
			    		}
			    		val += "*_*";
			    		if(data[i].ex2Name != null && data[i].ex2Name!="undefined") {
				    		val += data[i].ex2Name;
			    		}
			    		val += "*_*";
			    		if(data[i].ex3Name != null && data[i].ex3Name!="undefined") {
				    		val += data[i].ex3Name;
			    		}
			    		val += "*_*";
			    		if(data[i].ex4Name != null && data[i].ex4Name!="undefined") {
				    		val += data[i].ex4Name;
			    		}
			    		val += "*_*";
			    		if(data[i].ex5Name != null && data[i].ex5Name!="undefined") {
				    		val += data[i].ex5Name;
			    		}
			    		val += "*_*";
			    		if(data[i].ex6Name != null && data[i].ex6Name!="undefined") {
				    		val += data[i].ex6Name;
			    		}
			    		val += "*_*";
			    		if(data[i].title1Name != null && data[i].title1Name!="undefined") {
				    		val += data[i].title1Name;
			    		}
			    		val += "*_*";
			    		if(data[i].title2Name != null && data[i].title2Name!="undefined") {
				    		val += data[i].title2Name;
			    		}
			    		html += "<option value='"+ val +"'>"+ data[i].title +'</option>';
			    	}
			    	
			    	$("#p_sectionId").html(html);
			    	
			    	setSection();
			    },  
			     error : function() {  
			     }  
			});
		} else {
	    	$("#p_sectionId").html('');
		}		
	}
	
	function setSection() {
		var val = $("#p_sectionId").val();
		if(val != null) {
			val = val.substring(val.indexOf("*_*")+3);
			var ex1Name = val.substring(0,val.indexOf("*_*"));
			val = val.substring(val.indexOf("*_*")+3);
			var ex2Name = val.substring(0,val.indexOf("*_*"));
			val = val.substring(val.indexOf("*_*")+3);
			var ex3Name = val.substring(0,val.indexOf("*_*"));
			val = val.substring(val.indexOf("*_*")+3);
			var ex4Name = val.substring(0,val.indexOf("*_*"));
			val = val.substring(val.indexOf("*_*")+3);
			var ex5Name = val.substring(0,val.indexOf("*_*"));
			val = val.substring(val.indexOf("*_*")+3);
			var ex6Name = val.substring(0,val.indexOf("*_*"));;
			val = val.substring(val.indexOf("*_*")+3);
			var title1Name = val.substring(0,val.indexOf("*_*"));
			val = val.substring(val.indexOf("*_*")+3);
			var title2Name = val;
			setEx(1,ex1Name);
			setEx(2,ex2Name);
			setEx(3,ex3Name);
			setEx(4,ex4Name);
			setEx(5,ex5Name);
			setEx(6,ex6Name);
			
			setExTitle(1,title1Name);
			setExTitle(2,title2Name);
		}		
	}
		
	function setEx(i,ex1Name) {
		
		if(ex1Name=="") {
			$("#p_ex"+i+"Name").html("扩展"+i);
			$("#p_ex"+i+"Value").attr("placeholder","");
			$("#p_ex"+i+"Value").val("");
		} else {
			if(ex1Name.indexOf("{")>-1) {
				var o = JSON.parse(ex1Name);
				
				if(o.name != null && typeof(o.name) != "undefined") {
					$("#p_ex"+i+"Name").html(o.name);						
				} else {
					$("#p_ex"+i+"Name").html("扩展"+i);
				}
	
				if(o.placeholder != null && typeof(o.placeholder) != "undefined") {
					$("#p_ex"+i+"Value").attr("placeholder",o.placeholder);
				} else {
					$("#p_ex"+i+"Value").attr("placeholder","");
				}
	
				if(o.value != null && typeof(o.value) != "undefined") {
					$("#p_ex"+i+"Value").val(o.value);
				} else {
					$("#p_ex"+i+"Value").val("");
				}					
				
			} else {
				$("#p_ex"+i+"Name").html(ex1Name);
				$("#p_ex"+i+"Value").attr("placeholder","");
				$("#p_ex"+i+"Value").val("");
			}	
		}
	}
	function setExTitle(i,ex1Name) {
		
		if(ex1Name=="") {
			$("#p_title"+i+"name").html("副标题"+i);
			$("#p_title"+i).attr("placeholder","");
			$("#p_ex"+i).val("");
		} else {
			if(ex1Name.indexOf("{")>-1) {
				var o = JSON.parse(ex1Name);
				
				if(o.name != null && typeof(o.name) != "undefined") {
					$("#p_title"+i+"name").html(o.name);						
				} else {
					$("#p_title"+i+"name").html("副标题"+i);
				}
	
				if(o.placeholder != null && typeof(o.placeholder) != "undefined") {
					$("#p_title"+i).attr("placeholder",o.placeholder);
				} else {
					$("#p_title"+i).attr("placeholder","");
				}
	
				if(o.value != null && typeof(o.value) != "undefined") {
					$("#p_title"+i).val(o.value);
				} else {
					$("#p_title"+i).val("");
				}					
				
			} else {
				$("#p_title"+i+"name").html("副标题"+i);
				$("#p_title"+i).attr("placeholder","");
				$("#p_ex"+i).val("");
			}	
		}
	}
	
	$(function(){
		
		$("#submit").click(function(){
			if($("#imageStu").val() == 1){
				$("#p_imagePath").val("");
			}
			var sectionId = $("#p_sectionId").val();
			var pageId = $("#p_pageId").val();
			if(pageId==null && $.trim(pageId)==""){
				layer.msg('缺少页面', 3, 1);
			}else if(sectionId == null && $.trim(sectionId)==""){
				layer.msg('缺少位置', 3, 1);
			}else{
				sectionId = sectionId.substring(0,sectionId.indexOf("*_*"));
			$.ajax({
				"type":'POST',
				url:'${ctxPath}/cmsPage/dataSave',
				"data":{"id":$("#p_id").val(),"pageId":$("#p_pageId").val(),"channel":$("#p_channel").val(),"sectionId":sectionId,
				"title":$.trim($("#p_title").val()),"imagePath":$.trim($("#p_imagePath").val()),"orders":$.trim($("#p_orders").val()),
				"link":$.trim($("#p_link").val()),"ex1Value":$("#p_ex1Value").val(),"ex2Value":$("#p_ex2Value").val(),"ex3Value":$("#p_ex3Value").val(),
				"title1":$.trim($("#p_title1").val()),"title2":$.trim($("#p_title2").val()),"ex4Value":$("#p_ex4Value").val(),"ex5Value":$("#p_ex5Value").val(),
				"ex6Value":$("#p_ex6Value").val(),"imageSta":$("#imageStu").val()},
				"success":function(data,response){
					if(data.success){
						layer.msg('操作成功', 1, 1,function(){
							rePage();
							layer.closeAll();
						});
					}else{
						layer.msg(data.msg, 3, 1);
					}
				}
			});
			}
		});
	});
	
	function deleteImage(){
		document.getElementById("ImageId").style.display="none";
		$("#imageStu").val(1);
	}
	
	function pageDataUpdateUploadImg() {
		if($("#uploadFile").val() == ""){
			alert("请选择上传的图片！")
		}else{
			uploadImg($("#p_updateAppImg"),"uploadFile","${ctxPath}/cmsPage/upload/pic");
			document.getElementById("ImageId").style.display="";
			$("#imageStu").val(0);
		}
		
	}
</script>
